{"paragraphs":[{"text":"//read tracks file\nval rawListenings = sc.textFile(\"hdfs://127.0.0.1/user/cloudera/lastfm_output/listenings.tsv\")\nrawListenings.first\n\nval n = 10\ncase class SimpleListening(userid:String, traid:String, timestamp:String)\nval rawTracks = rawListenings.map(_.split(\"\\t\")).map(s => SimpleListening(s(1), s(0), s(2)))\nrawTracks.first\nrawTracks.count\nrawTracks.take(5)\n\nval userTrackPairs = rawTracks.map( r => (r.userid, r.traid) )\nuserTrackPairs.take(5)\n\n//count unique user-track occurences\nval countedTrackMap = userTrackPairs.map(s => (s,1))\ncountedTrackMap.count\ncountedTrackMap.take(20)\n\nval countedTracks = countedTrackMap.reduceByKey(_ + _)\ncountedTracks.count\ncountedTracks.take(20)\n\n//generate top n songs for all user\nval topNListenedTracksForUsers = countedTracks.map(s => (s._1._1, (s._1._2, s._2))).groupByKey().mapValues( iter => iter.toList.sortBy(_._2)(Ordering[Int].reverse).take(n) ).flatMapValues(x => x)\ntopNListenedTracksForUsers.take(20)\ntopNListenedTracksForUsers.count\n\nval topNListenedTracksForUsersFormatted = topNListenedTracksForUsers.map(  x => ( x._1 + \"\\t\" + x._2._1 + \"\\t\" + x._2._2 ) )\ntopNListenedTracksForUsersFormatted.take(20)\ntopNListenedTracksForUsersFormatted.count\n\n//save fav. songs into file \nval favsFile = \"hdfs://127.0.0.1/user/cloudera/lastfm_output/fav_tracks.tsv\"\ntopNListenedTracksForUsersFormatted.saveAsTextFile(favsFile)\n","dateUpdated":"May 23, 2016 11:28:58 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461688713937_-1152779993","id":"20160426-093833_2027032693","result":{"code":"SUCCESS","type":"TEXT","msg":"rawListenings: org.apache.spark.rdd.RDD[String] = hdfs://127.0.0.1/user/cloudera/lastfm_output/listenings.tsv MapPartitionsRDD[4380] at textFile at <console>:29\nres54: String = 0\t250\t2007-06-05T06:43:23Z\nn: Int = 10\ndefined class SimpleListening\nrawTracks: org.apache.spark.rdd.RDD[SimpleListening] = MapPartitionsRDD[4382] at map at <console>:32\nres56: SimpleListening = SimpleListening(250,0,2007-06-05T06:43:23Z)\nres57: Long = 16982280\nres58: Array[SimpleListening] = Array(SimpleListening(250,0,2007-06-05T06:43:23Z), SimpleListening(250,0,2007-04-13T11:52:25Z), SimpleListening(250,0,2006-10-09T02:00:47Z), SimpleListening(719,0,2007-01-05T15:16:48Z), SimpleListening(719,0,2007-01-03T18:17:05Z))\nuserTrackPairs: org.apache.spark.rdd.RDD[(String, String)] = MapPartitionsRDD[4383] at map at <console>:35\nres60: Array[(String, String)] = Array((250,0), (250,0), (250,0), (719,0), (719,0))\ncountedTrackMap: org.apache.spark.rdd.RDD[((String, String), Int)] = MapPartitionsRDD[4384] at map at <console>:38\nres63: Long = 16982280\nres64: Array[((String, String), Int)] = Array(((250,0),1), ((250,0),1), ((250,0),1), ((719,0),1), ((719,0),1), ((835,0),1), ((835,0),1), ((835,0),1), ((870,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1), ((349,0),1))\ncountedTracks: org.apache.spark.rdd.RDD[((String, String), Int)] = ShuffledRDD[4385] at reduceByKey at <console>:39\nres66: Long = 3963190\nres67: Array[((String, String), Int)] = Array(((845,514288),14), ((553,180102),2), ((178,289772),1), ((577,509203),5), ((509,36795),5), ((254,408544),3), ((182,735504),1), ((223,134115),2), ((943,145414),1), ((135,504526),2), ((689,751510),1), ((219,735816),2), ((570,380845),3), ((249,789800),15), ((984,901818),1), ((577,625389),1), ((779,297429),1), ((802,438318),4), ((780,482821),1), ((148,481173),2))\ntopNListenedTracksForUsers: org.apache.spark.rdd.RDD[(String, (String, Int))] = MapPartitionsRDD[4389] at flatMapValues at <console>:44\nres70: Array[(String, (String, Int))] = Array((82,(244121,51)), (82,(343796,45)), (82,(591018,44)), (82,(463415,42)), (82,(531288,42)), (82,(263950,41)), (82,(832813,41)), (82,(153874,40)), (82,(402416,39)), (82,(172084,38)), (588,(737671,119)), (588,(579382,81)), (588,(514283,65)), (588,(302570,65)), (588,(539673,65)), (588,(755698,62)), (588,(472104,62)), (588,(410127,50)), (588,(551311,49)), (588,(51627,47)))\nres71: Long = 9882\ntopNListenedTracksForUsersFormatted: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[4390] at map at <console>:45\nres73: Array[String] = Array(82\t244121\t51, 82\t343796\t45, 82\t591018\t44, 82\t463415\t42, 82\t531288\t42, 82\t263950\t41, 82\t832813\t41, 82\t153874\t40, 82\t402416\t39, 82\t172084\t38, 588\t737671\t119, 588\t579382\t81, 588\t514283\t65, 588\t302570\t65, 588\t539673\t65, 588\t755698\t62, 588\t472104\t62, 588\t410127\t50, 588\t551311\t49, 588\t51627\t47)\nres74: Long = 9882\nfavsFile: String = hdfs://127.0.0.1/user/cloudera/lastfm_output/fav_tracks.tsv\n"},"dateCreated":"Apr 26, 2016 9:38:33 AM","dateStarted":"May 22, 2016 12:20:21 PM","dateFinished":"May 22, 2016 12:24:35 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:306"},{"dateUpdated":"Apr 26, 2016 9:38:33 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461688713937_-1152779993","id":"20160426-093833_657895243","dateCreated":"Apr 26, 2016 9:38:33 AM","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:307"}],"name":"03 - exportFavTracks","id":"2BHVTU1TA","angularObjects":{"2BJEX9EKE":[],"2BHNRNXUS":[],"2BHYW4VGK":[],"2BKF83PSM":[],"2BM15S4NY":[],"2BKATJKHF":[],"2BJBC6G63":[],"2BJP5SDEU":[],"2BJAXCR48":[],"2BM76CV5M":[],"2BGC3HU85":[],"2BH7HBVDY":[],"2BJ46877K":[],"2BGV7SN9S":[]},"config":{"looknfeel":"default"},"info":{}}