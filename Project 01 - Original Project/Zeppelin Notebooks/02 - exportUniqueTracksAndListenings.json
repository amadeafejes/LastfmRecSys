{"paragraphs":[{"text":"//input file\nval rawListenings = sc.textFile(\"hdfs://127.0.0.1/user/cloudera/lastfm_input/userid-timestamp-artid-artname-traid-traname.tsv\")\n\n//select columns from file and filter\ncase class Listening(userid:String,timestamp:String,artid:String,artname:String,traid:String,traname:String)\nval listeningObjects = rawListenings.map(_.split(\"\\t\")).map(s => Listening(s(0),s(1),s(2),s(3),s(4),s(5))).filter(_.traid != \"\")\nlisteningObjects.first()\nlisteningObjects.count\n\n//create indexed unique tracks\nval uniqueTracksMap = listeningObjects.map(s => (s.traid, s)).combineByKey(\n  (value) => List(value), //when a key is found for the first time in a given partition, creates an initial value for that key\n  (aggr: List[Listening], value) => aggr ::: (value :: Nil), //is called when the key already has an accumulator\n  (aggr1: List[Listening], aggr2: List[Listening]) => aggr1 ::: aggr2\n).zipWithUniqueId.filter(_._1._2 != null).map( r => (r._2, r._1._2) )\nuniqueTracksMap.first()\nuniqueTracksMap.count\n\n//create unique tracks\nval uniqueTracks = uniqueTracksMap.map( r => (r._1, r._2(0)) ).map( r => (r._1 + \"\\t\" + r._2.traid + \"\\t\" + r._2.traname + \"\\t\" + r._2.artid + \"\\t\" + r._2.artname) )\nuniqueTracks.first()\n//save unique tracks into file\nval tracksFile = \"hdfs://127.0.0.1/user/cloudera/lastfm_output/unique_tracks.tsv\"\nuniqueTracks.saveAsTextFile(tracksFile)\n\n//method for user id\ndef convertUserId(tag: String):Int = {\n    //get int from format \"user_000758\" - last 6 characters\n    return tag.substring(5).toInt\n}\n//listenings with integer user id and integer track id\nval indexedListenings = \n    uniqueTracksMap.map( r => (r._2.map(e =>  \n    (r._1 + \"\\t\" + convertUserId(e.userid) + \"\\t\" + e.timestamp)) ) )\n    \n//save listenings into file\nval listeningsFile = \"hdfs://127.0.0.1/user/cloudera/lastfm_output/listenings.tsv\"\nval listeningsToSave = indexedListenings.flatMap(r => r)\nlisteningsToSave.count\nlisteningsToSave.saveAsTextFile(listeningsFile)\n\n//lines in the file: traid userid timestamp","dateUpdated":"May 22, 2016 1:56:01 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461684200421_1545228200","id":"20160426-082320_466359555","result":{"code":"SUCCESS","type":"TEXT","msg":"rawListenings: org.apache.spark.rdd.RDD[String] = hdfs://127.0.0.1/user/cloudera/lastfm_input/userid-timestamp-artid-artname-traid-traname.tsv MapPartitionsRDD[22] at textFile at <console>:24\ndefined class Listening\nlisteningObjects: org.apache.spark.rdd.RDD[Listening] = MapPartitionsRDD[25] at filter at <console>:27\nres18: Listening = Listening(user_000001,2009-05-04T13:06:09Z,a7f7df4a-77d8-4f12-8acd-5c60c93f4de8,坂本龍一,f7c1f8f8-b935-45ed-8fc8-7def69d92a10,The Last Emperor (Theme))\nres19: Long = 16982280\nuniqueTracksMap: org.apache.spark.rdd.RDD[(Long, List[Listening])] = MapPartitionsRDD[30] at map at <console>:35\nres22: (Long, List[Listening]) = (0,List(Listening(user_000250,2007-06-05T06:43:23Z,d6ed7887-a401-47a8-893c-34b967444d26,Ramones,29004008-c6ff-4933-8255-6f10de17ad12,She Belongs To Me), Listening(user_000250,2007-04-13T11:52:25Z,d6ed7887-a401-47a8-893c-34b967444d26,Ramones,29004008-c6ff-4933-8255-6f10de17ad12,She Belongs To Me), Listening(user_000250,2006-10-09T02:00:47Z,d6ed7887-a401-47a8-893c-34b967444d26,Ramones,29004008-c6ff-4933-8255-6f10de17ad12,She Belongs To Me), Listening(user_000719,2007-01-05T15:16:48Z,d6ed7887-a401-47a8-893c-34b967444d26,Ramones,29004008-c6ff-4933-8255-6f10de17ad12,She Belongs To Me), Listening(user_000719,2007-01-03T18:17:05Z,d6ed7887-a401-47a8-893c-34b967444d26,Ramones,29004008-c6ff-4933-8255-6f10de17ad12,She Belongs To Me), Listening(user_000835,2008-02-1...res23: Long = 961416\nuniqueTracks: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[32] at map at <console>:33\nres26: String = 0\t29004008-c6ff-4933-8255-6f10de17ad12\tShe Belongs To Me\td6ed7887-a401-47a8-893c-34b967444d26\tRamones\ntracksFile: String = hdfs://127.0.0.1/user/cloudera/lastfm_output/unique_tracks.tsv\nconvertUserId: (tag: String)Int\nindexedListenings: org.apache.spark.rdd.RDD[List[String]] = MapPartitionsRDD[34] at map at <console>:35\nlisteningsFile: String = hdfs://127.0.0.1/user/cloudera/lastfm_output/listenings.tsv\nlisteningsToSave: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[35] at flatMap at <console>:35\nres34: Long = 16982280\n"},"dateCreated":"Apr 26, 2016 8:23:20 AM","dateStarted":"May 22, 2016 1:56:01 AM","dateFinished":"May 22, 2016 2:21:21 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:213"},{"dateUpdated":"Apr 26, 2016 8:23:20 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461684200421_1545228200","id":"20160426-082320_1937212982","dateCreated":"Apr 26, 2016 8:23:20 AM","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:214"}],"name":"02 - exportUniqueTracksAndListenings","id":"2BM9Z7PHE","angularObjects":{"2BJEX9EKE":[],"2BHNRNXUS":[],"2BHYW4VGK":[],"2BKF83PSM":[],"2BM15S4NY":[],"2BKATJKHF":[],"2BJBC6G63":[],"2BJP5SDEU":[],"2BJAXCR48":[],"2BM76CV5M":[],"2BGC3HU85":[],"2BH7HBVDY":[],"2BJ46877K":[],"2BGV7SN9S":[]},"config":{"looknfeel":"default"},"info":{}}